<!doctype html>
<html>
    <head>
        <title>Librairie Google Charts</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="../../css/global.css">
        <meta name="keywords" content="programmation, sql, r, sas, python, mongo, nosql, html, css, javascript, d3, google charts, chart.js">
        <meta name="description" content="Page professionnelle de FX Jollois, contenant des notes de programmation, des tutoriels et des slides de cours, ainsi que des liens vers les projets GitHub personnels">
        <meta name="author" content="Francois-Xavier Jollois">
        <meta name="copyright" content="&#xA9;">
    <link rel="stylesheet" href="../../lib/highlight/styles/default.css">
<link rel="stylesheet" href="../../css/remark-slides.css"></head>
    <body>
        <header></header>
        <section><textarea id="source"># Librairie Google Charts

## Introduction &#xE0; son utilisation

[Lien](https://developers.google.com/chart/) vers la librairie

- Librairie facile &#xE0; utilis&#xE9;e
- Grand choix de graphiques &#xE0; disposition
- Personnalisation possible
- Sur des donn&#xE9;es au format `DataTable` sp&#xE9;cifique

[Exemple](exemple.html)


---
## Chargement de la librairie

En 2 &#xE9;tapes :
1. Chargement de la librairie **Google JSAPI** avec l&apos;URL `https://www.google.com/jsapi` dans une balise `script`
2. Chargement de la librairie **Google Visualization**, en indiquant le ou les packages &#xE0; charger (i.e. `corechart`, `table`, ...) avec la fonction `google.load` prenant en param&#xE8;tres :
    - la librairie `visualization` 
    - la version de celle-ci (`1` pour version stable, `1.1` pour la nouvelle)
    - la liste des packages 

Ajout d&apos;une fonction (`google.setOnLoadCallback (f)`) permettant le lancement d&apos;une fonction `f` lorsque la librairie est charg&#xE9;e, pour &#xE9;viter les probl&#xE8;mes de synchronisation

---
## sur l&apos;exemple

```
<script type="text/javascript" src="https://www.google.com/jsapi">
</script>
<script type="text/javascript">

 // Chargement de la librairie et du package corechart
 google.load('visualization', '1.0', {'packages':['corechart']});

 // Définition de la fonction à exécuter (drawChart) lorsque la 
 // librairie est chargée
 google.setOnLoadCallback(drawChart);
 
 ...
 </script>
```

---
## Format des donn&#xE9;es

Utilisation de la classe `google.visualization.DataTable` :
- objet &#xE0; deux dimensions
- colonnes d&#xE9;finies par un type, et &#xE9;ventuellement un label et/ou un id

Possibilit&#xE9; de cr&#xE9;er un objet de diff&#xE9;rentes mani&#xE8;res :
- Cr&#xE9;ation d&apos;un objet vide, d&#xE9;finition des colonnes puis insertion des lignes
- A partir d&apos;un tableau JSON, avec un format sp&#xE9;cifique (la premi&#xE8;re ligne contenant les infos des colonnes)
- A partir d&apos;un litt&#xE9;ral JSON, avec aussi un format sp&#xE9;cifique (deux objets : un pour la d&#xE9;finition des colonnes, un pour les valeurs des lignes)
- A l&apos;aide d&apos;une requ&#xEA;te `SQL` sur une source *Spreadsheet* ou *Fusion Table*

---
## sur l&apos;exemple

```js
// Cr&#xE9;ation d&apos;une variable, instance de DataTable
var data = new google.visualization.DataTable();

// D&#xE9;finition des colonnes de la table
data.addColumn(&apos;string&apos;, &apos;Topping&apos;);
data.addColumn(&apos;number&apos;, &apos;Slices&apos;);

// Insertion des lignes (ici en une fois)
data.addRows([
  [&apos;Mushrooms&apos;, 3],
  [&apos;Onions&apos;, 1],
  [&apos;Olives&apos;, 1],
  [&apos;Zucchini&apos;, 1],
  [&apos;Pepperoni&apos;, 2]
]);
```

---
## Personnalisation du graphique

Chaque graphique est personnalisable &#xE0; l&apos;aide de param&#xE8;tres pour certains communs &#xE0; tous, pour d&apos;autres sp&#xE9;cifiques &#xE0; chaque type de graphique

Utilisation d&apos;un objet JSON contenant la d&#xE9;finition des param&#xE8;tres du graphique

Quelques param&#xE8;tres communs :
- `width` et `height` : largeur et hauteur du graphique
- `title` : titre
- ...

---
## sur l&apos;exemple

```js
// Cr&#xE9;ation d&apos;un objet JSON
var options = {
    // on d&#xE9;finit ici le titre et la taille du graphique
    &apos;title&apos;:&apos;How Much Pizza I Ate Last Night&apos;,
    &apos;width&apos;: 600,
    &apos;height&apos;: 400,
    // ainsi que les param&#xE8;tres de la l&#xE9;gende, qui peuvent &#xEA;tre 
    // d&#xE9;taill&#xE9;e dans un objet JSON
    &apos;legend&apos;: {
        position: &apos;bottom&apos;, 
        textStyle: {
            color: &apos;blue&apos;, 
            fontSize: 10
        }
    }
};
```

---
## Cr&#xE9;ation du graphique

En 2 &#xE9;tapes :
- Instanciation dans une variable du type de graphique (via une fonction sp&#xE9;cifique &#xE0; chaque type de l&apos;objet `google.visualization` prenant en param&#xE8;tre l&apos;id de la div conteneur)
    - `PieChart` pour un diagramme circulaire
    - `BarChart` pour un diagramme en barre horizontale
    - ...
- Dessin du graphique via la fonction `draw()` prenant en param&#xE8;tre deux objets 
    - les donn&#xE9;es
    - les options

---
## sur l&apos;exemple

```js
// Cr&#xE9;ation d&apos;une instance de PieChart, et indication du conteneur 
// du graphique
var cont = document.getElementById(&apos;chart_div&apos;);
var chart = new google.visualization.PieChart(cont);

// Dessin du graphique selon les donn&#xE9;es et les options pass&#xE9;es 
// en param&#xE8;tres
chart.draw(data, options);
```

**Note** Dans le corps du fichier HTML doit se trouver une `div` dont l&apos;identifiant est `chart_div`
```
<body>
    <div id="chart_div"></div>
</body>
```

---
## Ajout d&apos;interactivit&#xE9;

Possibilit&#xE9; d&apos;ajouter un *listener* sur un graphique (via la fonction `google.visualization.events.addListener()`) prenant en param&#xE8;tre :
- la variable instance du graphique
- le type d&apos;&#xE9;v&#xE9;nement
    - `ready`
    - `select`
    - `error`
    - `onmouseover` et `onmouseout`
- la fonction &#xE0; ex&#xE9;cuter lors de l&apos;&#xE9;v&#xE9;nement

Fonctions des instances int&#xE9;ressantes dans ce cas :
- `getSelection`, `getValue`
- `setSelection`

---
## sur l&apos;exemple

```no
// D&#xE9;finition de la fonction a ex&#xE9;cuter lors de l&apos;&#xE9;v&#xE9;nement
function selectHandler() {
    // R&#xE9;cup&#xE9;ration de la s&#xE9;lection
    var selectedItem = chart.getSelection()[0];
    // si s&#xE9;lection
    if (selectedItem) {
        // r&#xE9;cup&#xE9;ration de la valeur choisie
        var topping = data.getValue(selectedItem.row, 0);
        // affichage via pop-up classique
        alert(&apos;The user selected &apos; + topping);
    }
}
// Ajout du listener sur le graphique, pour l&apos;&#xE9;v&#xE9;nement &quot;select&quot;
google.visualization.events.addListener(
    chart, &apos;select&apos;, selectHandler);    
```
</textarea><script src="https://gnab.github.io/remark/downloads/remark-latest.min.js"></script><script>var slideshow = remark.create();
</script></section>
        <footer></footer>
    <script src="../../lib/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script></body>
</html>